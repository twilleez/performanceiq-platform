<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0f14" />
  <meta name="description" content="PerformanceIQ — Offline-first team performance tracking" />
  <meta name="color-scheme" content="dark light" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />

  <title>PerformanceIQ</title>

  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <!-- ===================== Splash ===================== -->
  <div id="splash" class="splash" role="status" aria-live="polite" aria-label="Loading PerformanceIQ">
    <div class="splash-card">
      <div class="brand">
        <div class="logo-dot" aria-hidden="true"></div>
        <div>
          <div class="brand-title">PerformanceIQ</div>
          <div class="brand-sub">Offline-first • Team-ready</div>
        </div>
      </div>

      <div class="splash-loading" aria-hidden="true">
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
      </div>
      <div id="splashText" class="muted small" style="margin-top:10px">Preparing your workspace…</div>
    </div>
  </div>

  <!-- ===================== Topbar ===================== -->
  <header class="topbar" role="banner">
    <div class="topbar-left">
      <div class="appmark" aria-label="PerformanceIQ">
        <span class="appmark-dot" aria-hidden="true"></span>
        <span class="appmark-title">PerformanceIQ</span>
      </div>

      <span class="pill" id="savePill" title="Save status" aria-live="polite" aria-label="Save status">
        <span class="dot" id="saveDot" aria-hidden="true"></span>
        <span id="saveText">Saved</span>
      </span>

      <span class="pill" id="teamPill"  title="Active team"   aria-live="polite" aria-label="Active team">Team: —</span>
      <span class="pill" id="cloudPill" title="Cloud status"  aria-live="polite" aria-label="Cloud status">Cloud: Local</span>

      <button class="iconbtn" id="btnThemeToggle" type="button"
              aria-label="Toggle dark/light mode" title="Toggle dark/light">☾</button>
    </div>

    <div class="topbar-right">
      <button class="btn ghost" id="btnHelp" type="button">Help</button>
      <button class="btn" id="btnAccount" type="button" aria-haspopup="dialog" aria-controls="accountDrawer">Account</button>
    </div>
  </header>

  <!-- ===================== Layout ===================== -->
  <main class="layout" id="mainContent">
    <!-- Desktop nav -->
    <nav class="nav" role="navigation" aria-label="Primary navigation" id="desktopNav">
      <button class="navbtn" data-view="home"    type="button" aria-current="page">Home</button>
      <button class="navbtn" data-view="team"    type="button">Team</button>
      <button class="navbtn" data-view="train"   type="button">Train</button>
      <button class="navbtn" data-view="profile" type="button">Profile</button>
    </nav>

    <!-- Content -->
    <section class="content" aria-live="polite" aria-atomic="false">
      <!-- Home -->
      <section class="view" id="view-home" role="region" aria-label="Home" tabindex="-1">
        <div class="card">
          <div class="row between" style="gap:10px;flex-wrap:wrap">
            <div>
              <div class="card-title" role="heading" aria-level="1">Home</div>
              <div class="small muted" id="homeSub">Welcome back.</div>
            </div>
            <div class="row gap wrap">
              <button class="btn" id="todayButton" type="button" aria-label="Generate, start, or log today's session">
                Generate → Start → Log
              </button>
              <span class="pill" id="todayTimer" aria-live="polite" aria-label="Timer status">No timer running</span>
              <button class="iconbtn" id="tipToday" type="button" aria-label="Help for today workflow">?</button>
            </div>
          </div>

          <div class="grid2" style="margin-top:12px">
            <div class="mini">
              <div class="row between">
                <div class="minihead" role="heading" aria-level="2">Today</div>
                <button class="iconbtn" id="tipQuick" type="button" aria-label="Help for today">?</button>
              </div>
              <div class="minibody" id="todayBlock" aria-live="polite">—</div>
            </div>

            <div class="mini">
              <div class="row between">
                <div class="minihead" role="heading" aria-level="2">Quick actions</div>
                <button class="iconbtn" id="tipTrain" type="button" aria-label="Help for quick actions">?</button>
              </div>

              <div class="row gap wrap">
                <button class="btn"       id="qaTrain" type="button">Open Train</button>
                <button class="btn ghost" id="qaTeam"  type="button">Manage Team</button>
              </div>

              <div class="hr"></div>
              <div class="minihead">PerformanceIQ Score</div>
              <div class="minibody" id="piqScoreHome">—</div>
              <div class="small muted" id="piqScoreNote" style="margin-top:6px">Score updates as you log.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Team -->
      <section class="view" id="view-team" role="region" aria-label="Team" tabindex="-1" hidden>
        <div class="card">
          <div class="row between">
            <div>
              <div class="card-title" role="heading" aria-level="1">Team</div>
              <div class="small muted">Roster, roles, join codes, and dashboards.</div>
            </div>
            <button class="iconbtn" id="tipTeam" type="button" aria-label="Help for Team">?</button>
          </div>
          <div id="teamBody" style="margin-top:12px" aria-live="polite"></div>
        </div>
      </section>

      <!-- Train -->
      <section class="view" id="view-train" role="region" aria-label="Train" tabindex="-1" hidden>
        <div class="card">
          <div class="row between">
            <div>
              <div class="card-title" role="heading" aria-level="1">Train</div>
              <div class="small muted" id="trainSub">Workouts tailored to the selected sport.</div>
            </div>
            <button class="iconbtn" id="tipTrain2" type="button" aria-label="Help for Train">?</button>
          </div>
          <div id="trainBody" style="margin-top:12px" aria-live="polite"></div>
        </div>
      </section>

      <!-- Profile -->
      <section class="view" id="view-profile" role="region" aria-label="Profile" tabindex="-1" hidden>
        <div class="card">
          <div class="row between">
            <div>
              <div class="card-title" role="heading" aria-level="1">Profile</div>
              <div class="small muted">Your role, preferences, score, risks, and insights.</div>
            </div>
            <button class="iconbtn" id="tipProfile" type="button" aria-label="Help for Profile">?</button>
          </div>
          <div id="profileBody" style="margin-top:12px" aria-live="polite"></div>
        </div>
      </section>

    </section>
  </main>

  <!-- ===================== Mobile bottom nav ===================== -->
  <nav class="bottomnav" id="bottomNav" aria-label="Bottom navigation">
    <button class="tab" data-view="home"    type="button" aria-current="page"><span class="tablbl">Home</span></button>
    <button class="tab" data-view="team"    type="button"><span class="tablbl">Team</span></button>
    <button class="tab" data-view="train"   type="button"><span class="tablbl">Train</span></button>
    <button class="tab" data-view="profile" type="button"><span class="tablbl">Profile</span></button>
  </nav>

  <!-- ===================== FAB + sheet ===================== -->
  <button class="fab" id="fab" type="button" aria-label="Quick log — open action sheet"
          aria-haspopup="dialog" aria-controls="fabSheet">+</button>

  <div class="sheet-backdrop" id="sheetBackdrop" hidden></div>
  <div class="sheet" id="fabSheet" role="dialog" aria-modal="true"
       aria-labelledby="fabSheetTitle" aria-hidden="true" hidden>
    <div class="sheet-head">
      <div class="sheet-title" id="fabSheetTitle">Quick log</div>
      <button class="btn ghost" id="btnCloseSheet" type="button" aria-label="Close quick log">Close</button>
    </div>
    <div class="sheet-body">
      <button class="btn"       id="fabLogWorkout"   type="button">Log workout</button>
      <button class="btn ghost" id="fabLogNutrition" type="button">Log nutrition</button>
      <button class="btn ghost" id="fabLogWellness"  type="button">Log wellness</button>
    </div>
  </div>

  <!-- ===================== Account Drawer ===================== -->
  <div class="drawer-backdrop" id="drawerBackdrop" hidden></div>
  <aside class="drawer" id="accountDrawer"
         role="dialog" aria-modal="true"
         aria-labelledby="drawerTitle"
         aria-hidden="true">

    <div class="drawer-head">
      <div>
        <div class="drawer-title" id="drawerTitle">Account</div>
        <div class="small muted">Preferences • appearance • data management</div>
      </div>
      <button class="btn ghost" id="btnCloseDrawer" type="button" aria-label="Close account drawer">Close</button>
    </div>

    <div class="drawer-body">

      <!-- Role & Sport -->
      <div class="card subtle" role="group" aria-labelledby="sectionRoleSport">
        <div class="card-title" id="sectionRoleSport" role="heading" aria-level="2">Role &amp; Sport</div>
        <div class="grid2" style="margin-top:10px">
          <div class="field">
            <label for="roleSelect">Role</label>
            <select id="roleSelect" autocomplete="off">
              <option value="owner">Owner</option>
              <option value="coach">Coach</option>
              <option value="athlete">Athlete</option>
              <option value="parent">Parent</option>
              <option value="viewer">Viewer</option>
            </select>
          </div>
          <div class="field">
            <label for="sportSelect">Sport</label>
            <select id="sportSelect" autocomplete="off">
              <option value="basketball">Basketball</option>
              <option value="football">Football</option>
              <option value="soccer">Soccer</option>
              <option value="baseball">Baseball</option>
              <option value="volleyball">Volleyball</option>
              <option value="track">Track</option>
            </select>
          </div>
        </div>

        <div class="field" style="margin-top:10px">
          <label for="preferredSessionSelect">Preferred session type</label>
          <select id="preferredSessionSelect" autocomplete="off">
            <option value="practice">Practice</option>
            <option value="strength">Strength</option>
            <option value="speed">Speed</option>
            <option value="conditioning">Conditioning</option>
            <option value="recovery">Recovery</option>
            <option value="competition_prep">Competition Prep</option>
          </select>
        </div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn"       id="btnSaveProfile" type="button">Save</button>
          <button class="btn ghost" id="btnRunTour"     type="button">Tour this tab</button>
        </div>
      </div>

      <!-- Appearance -->
      <div class="card subtle" style="margin-top:12px" role="group" aria-labelledby="sectionAppearance">
        <div class="card-title" id="sectionAppearance" role="heading" aria-level="2">Appearance</div>
        <div class="grid2" style="margin-top:10px">
          <div class="field">
            <label for="themeModeSelect">Mode</label>
            <select id="themeModeSelect" autocomplete="off">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
            </select>
          </div>
          <div class="field">
            <label for="themeSportSelect">Accent sport</label>
            <select id="themeSportSelect" autocomplete="off">
              <option value="basketball">Basketball</option>
              <option value="football">Football</option>
              <option value="soccer">Soccer</option>
              <option value="baseball">Baseball</option>
              <option value="volleyball">Volleyball</option>
              <option value="track">Track</option>
            </select>
          </div>
        </div>
        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn" id="btnSaveTheme" type="button">Save theme</button>
        </div>
      </div>

      <!-- Data Management -->
      <div class="card subtle" style="margin-top:12px" role="group" aria-labelledby="sectionData">
        <div class="card-title" id="sectionData" role="heading" aria-level="2">Data Management</div>
        <div class="small muted">Export/Import/Reset are here. Risky actions require confirmation.</div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn ghost" id="btnExport" type="button">Export JSON</button>
          <label class="btn ghost" style="cursor:pointer">
            Import JSON
            <input id="fileImport" type="file" accept="application/json"
                   aria-label="Import JSON file" style="display:none" />
          </label>
          <button class="btn danger" id="btnResetLocal" type="button">Reset local</button>
        </div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn" id="btnRunGrade" type="button">Run QA Grade</button>
        </div>

        <div class="small muted" id="dataMsg" style="margin-top:8px" aria-live="polite">—</div>
        <pre id="gradeReport" class="small muted"
             style="white-space:pre-wrap;margin-top:8px"
             aria-live="polite" role="status">—</pre>
      </div>

      <div class="card subtle" style="margin-top:12px" role="group" aria-labelledby="sectionCloud">
        <div class="card-title" id="sectionCloud" role="heading" aria-level="2">Cloud (optional)</div>
        <div class="small muted">Offline-first build. Cloud sync is a later phase.</div>
      </div>

    </div>
  </aside>

  <!-- ===================== Help Drawer ===================== -->
  <div class="drawer-backdrop" id="helpBackdrop" hidden></div>
  <aside class="drawer drawer-help" id="helpDrawer"
         role="dialog" aria-modal="true"
         aria-labelledby="helpDrawerTitle"
         aria-hidden="true">

    <div class="drawer-head">
      <div>
        <div class="drawer-title" id="helpDrawerTitle">Help</div>
        <div class="small muted">Searchable guidance (Ctrl/⌘+K)</div>
      </div>
      <button class="btn ghost" id="btnCloseHelp" type="button" aria-label="Close help drawer">Close</button>
    </div>

    <div class="drawer-body">
      <div class="field">
        <label for="helpSearch">Search</label>
        <input id="helpSearch" type="search"
               placeholder="Try: today, session types, risk, nutrition, heatmap…"
               autocomplete="off" spellcheck="false" />
      </div>
      <div id="helpResults" style="margin-top:10px" aria-live="polite" role="region" aria-label="Help results"></div>
    </div>
  </aside>

  <!-- ===================== Toasts ===================== -->
  <div class="toast" id="toast" hidden role="status" aria-live="polite" aria-atomic="true"></div>
  <div id="undoToast" hidden role="status" aria-live="assertive" aria-atomic="true"></div>

  <!-- ===================== Scripts ===================== -->
  <script src="./dataStore.js"></script>
  <script src="./nutritionEngine.js"></script>
  <script src="./periodizationEngine.js"></script>
  <script src="./core.js"></script>

  <!-- Splash hide — non-blocking -->
  <script>
    (function () {
      var splash     = document.getElementById("splash");
      var splashText = document.getElementById("splashText");
      function hide() {
        if (!splash) return;
        splash.setAttribute("aria-hidden", "true");
        splash.style.display = "none";
      }
      setTimeout(function () {
        if (splashText) splashText.textContent = "Ready.";
        hide();
      }, 650);
      setTimeout(hide, 2000);
    })();
  </script>
</body>
</html>
