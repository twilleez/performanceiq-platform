<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PerformanceIQ</title>

  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="favicon.ico">
</head>

<body>
  <!-- LOADING SCREEN -->
  <div id="loadingScreen" style="position:fixed;inset:0;z-index:99999;display:flex;align-items:center;justify-content:center;background:rgba(7,11,18,.98);color:#eaf0ff;font-family:system-ui;">
    <div style="display:flex;flex-direction:column;gap:10px;align-items:center">
      <div style="width:10px;height:10px;border-radius:999px;background:#00d4aa;box-shadow:0 0 0 8px rgba(0,212,170,.15);"></div>
      <div style="font-weight:700;letter-spacing:.4px;">Loading PerformanceIQ‚Ä¶</div>
      <div style="opacity:.7;font-size:12px;">If this takes longer than a few seconds, refresh once.</div>
    </div>
  </div>

  <!-- APP -->
  <div class="app-shell">
    <nav class="sidebar">
      <div class="sidebar-section">Main</div>
      <button class="nav-btn active" data-view="dashboard"><i class="nav-icon">‚¨°</i> Dashboard</button>
      <button class="nav-btn" data-view="athletes"><i class="nav-icon">‚óâ</i> Athletes <span class="nav-badge" id="riskBadge" style="display:none">0</span></button>
      <button class="nav-btn" data-view="train"><i class="nav-icon">‚ñ∑</i> Train</button>
      <button class="nav-btn" data-view="analytics"><i class="nav-icon">‚óà</i> Analytics</button>

      <div class="sidebar-section">Manage</div>
      <button class="nav-btn" data-view="schedule"><i class="nav-icon">üìÖ</i> Schedule</button>
      <button class="nav-btn" data-view="wellness"><i class="nav-icon">üåô</i> Wellness</button>
      <button class="nav-btn" data-view="nutrition"><i class="nav-icon">ü•ó</i> Nutrition</button>
      <button class="nav-btn" data-view="settings"><i class="nav-icon">‚öô</i> Settings</button>

      <div class="sidebar-bottom">
        <div class="user-block" id="userBlock">
          <div class="user-avatar" id="userAv">CD</div>
          <div>
            <div class="user-name" id="userName">Coach Davis</div>
            <div class="user-role" id="userRole">Head Coach ¬∑ Basketball</div>
          </div>
        </div>
      </div>
    </nav>

    <main class="main-content">
      <!-- DASHBOARD -->
      <section class="view active" id="view-dashboard">
        <div class="page-header stagger">
          <div>
            <div class="page-title" id="dashTitle">TEAM DASHBOARD</div>
            <div class="page-sub" id="dashSub">Loading‚Ä¶</div>
          </div>
          <div class="page-actions">
            <div class="chip green" id="chipOnline"><span class="pulse" style="background:var(--green)"></span><span id="chipOnlineText">‚Äî online</span></div>
            <div class="chip red" id="chipFlags" style="display:none"><span id="chipFlagsText">‚Äî flags</span></div>
            <div class="chip orange" id="chipGame" style="display:none"><span id="chipGameText2">Game ‚Äî</span></div>
          </div>
        </div>

        <div class="stat-grid stagger" id="statGrid">
          <div class="stat-card accent">
            <div class="stat-label">Avg PIQ Score</div>
            <div class="stat-value" id="statAvg">‚Äî</div>
            <div class="stat-sub up" id="statAvgSub">‚Üë loading‚Ä¶</div>
            <div class="sparkline" id="sparkAvg"></div>
          </div>
          <div class="stat-card green">
            <div class="stat-label">Ready to Train</div>
            <div class="stat-value" id="statReady">‚Äî</div>
            <div class="stat-sub" id="statReadySub">‚Äî athletes</div>
          </div>
          <div class="stat-card yellow">
            <div class="stat-label">Monitor Load</div>
            <div class="stat-value" id="statMonitor">‚Äî</div>
            <div class="stat-sub down" id="statMonitorSub">‚Äî athletes</div>
          </div>
          <div class="stat-card red">
            <div class="stat-label">High Risk / Rest</div>
            <div class="stat-value" id="statRisk">‚Äî</div>
            <div class="stat-sub" id="statRiskSub">Action required</div>
          </div>
        </div>

        <div class="grid-main">
          <div style="display:flex;flex-direction:column;gap:18px">
            <div class="card">
              <div class="card-header">
                <div class="card-title">Athlete Readiness Board</div>
                <a class="card-link" id="viewAllAthletes">View all ‚Üí</a>
              </div>
              <table class="heatmap" id="heatmapTable">
                <thead>
                  <tr>
                    <th>Athlete</th>
                    <th>PIQ</th>
                    <th>Readiness</th>
                    <th>ACWR</th>
                    <th>Flags</th>
                    <th>Trend</th>
                  </tr>
                </thead>
                <tbody id="heatmapBody"></tbody>
              </table>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">Load Monitoring (ACWR)</div>
                <span class="card-link" id="loadLegend"></span>
              </div>
              <div class="card-body">
                <div class="load-bar-list" id="loadBarList"></div>
                <div class="load-legend">
                  <span>‚úÖ Safe &lt;1.3</span>
                  <span>‚ö†Ô∏è Watch 1.3‚Äì1.5</span>
                  <span>‚õî Risk &gt;1.5</span>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">Team Activity</div>
                <a class="card-link">See all ‚Üí</a>
              </div>
              <div class="card-body">
                <div class="feed-list" id="activityFeed"></div>
              </div>
            </div>
          </div>

          <div style="display:flex;flex-direction:column;gap:16px">
            <div>
              <div class="section-label">RISK ALERTS</div>
              <div style="display:flex;flex-direction:column;gap:8px" id="alertsList"></div>
            </div>

            <div class="card">
              <div class="card-header">
                <div class="card-title">Roster Readiness</div>
                <a class="card-link" id="rosterMore">Full ‚Üí</a>
              </div>
              <div id="rosterMini"></div>
            </div>

            <div>
              <div class="section-label">UPCOMING</div>
              <div class="event-list" id="eventList"></div>
            </div>

            <div class="insight-card">
              <div class="insight-tag">‚ú¶ Weekly Insight</div>
              <div class="insight-body" id="insightText">Loading insight‚Ä¶</div>
            </div>

            <div class="insight-card">
              <div class="insight-tag">üìÖ Periodization (4-week)</div>
              <div class="insight-body" style="padding-top:6px">
                <div id="periodPlan"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ATHLETES / TRAIN / ANALYTICS / SCHEDULE / WELLNESS / NUTRITION / SETTINGS
           Keep the rest of your existing sections exactly as you already have them.
           (No functional changes needed for the loader fix.) -->
    </main>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <!-- HARD KILL SWITCH FOR LOADER + CACHE -->
  <script>
    (function () {
      function killLoader() {
        const ls = document.getElementById('loadingScreen');
        if (ls) ls.style.setProperty('display', 'none', 'important');
      }

      // Hide as early as possible (faster than waiting for "load")
      document.addEventListener('DOMContentLoaded', killLoader);
      window.addEventListener('load', killLoader);

      // Absolute fallback so it never traps the UI
      setTimeout(killLoader, 2500);

      // If a service worker is caching an old build, it can keep you stuck.
      // This clears SW + caches (safe no-op if none exist).
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations()
          .then(regs => regs.forEach(r => r.unregister()))
          .catch(() => {});
      }
      if (window.caches && caches.keys) {
        caches.keys()
          .then(keys => Promise.all(keys.map(k => caches.delete(k))))
          .catch(() => {});
      }
    })();
  </script>

  <!-- MAIN APP ENTRY (cache-busted) -->
  <script type="module" src="./js/app.js?v=20260302"></script>
</body>
</html>
