<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0f14" />
  <title>PerformanceIQ</title>
  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <!-- Splash -->
  <div id="splash" class="splash" aria-hidden="false">
    <div class="splash-card">
      <div class="brand">
        <div class="logo-dot"></div>
        <div>
          <div class="brand-title">PerformanceIQ</div>
          <div class="brand-sub">Offline-first • Team-ready</div>
        </div>
      </div>
      <div class="splash-loading">
        <div class="spinner" aria-hidden="true"></div>
        <div id="splashText">Loading…</div>
      </div>
    </div>
  </div>

  <!-- App -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="appmark">
        <span class="appmark-dot" aria-hidden="true"></span>
        <span class="appmark-title">PerformanceIQ</span>
      </div>
      <span class="pill" id="activeTeamPill" title="Active team">Team: Default</span>
    </div>

    <div class="topbar-right">
      <button class="btn ghost" id="btnSeed">Seed Demo</button>
      <button class="btn" id="btnExport">Export</button>
      <label class="btn ghost filebtn">
        Import
        <input id="fileImport" type="file" accept="application/json" />
      </label>
    </div>
  </header>

  <main class="layout">
    <!-- Nav -->
    <nav class="nav" role="navigation" aria-label="Primary">
      <button class="navbtn" data-view="dashboard">Dashboard</button>
      <button class="navbtn" data-view="team">Team</button>
      <button class="navbtn" data-view="log">Log</button>
      <button class="navbtn" data-view="nutrition">Elite Nutrition</button>
      <button class="navbtn" data-view="periodization">Periodization</button>
      <button class="navbtn" data-view="settings">Settings</button>
    </nav>

    <!-- Content -->
    <section class="content">
      <!-- DASHBOARD -->
      <section class="view" id="view-dashboard" data-view>
        <div class="grid2">
          <div class="card">
            <div class="cardhead">
              <h2>PerformanceIQ Score</h2>
              <span class="muted">Brand differentiator</span>
            </div>
            <div class="row gap">
              <div class="field">
                <label>Pick athlete</label>
                <select id="dashAthlete"></select>
              </div>
              <div class="field">
                <label>Date</label>
                <input id="dashDate" type="date" />
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn" id="btnRecalcScore">Recalculate</button>
              </div>
            </div>

            <div class="scorewrap">
              <div class="scorebig">
                <div class="scorelabel">PIQ Score</div>
                <div class="scorenum" id="piqScore">—</div>
                <div class="scoremeta" id="piqBand">—</div>
              </div>

              <div class="scorebars">
                <div class="barrow">
                  <div class="barlabel">Readiness</div>
                  <div class="bar"><div class="barfill" id="barReadiness" style="width:0%"></div></div>
                  <div class="barnum" id="numReadiness">—</div>
                </div>
                <div class="barrow">
                  <div class="barlabel">Training</div>
                  <div class="bar"><div class="barfill" id="barTraining" style="width:0%"></div></div>
                  <div class="barnum" id="numTraining">—</div>
                </div>
                <div class="barrow">
                  <div class="barlabel">Recovery</div>
                  <div class="bar"><div class="barfill" id="barRecovery" style="width:0%"></div></div>
                  <div class="barnum" id="numRecovery">—</div>
                </div>
                <div class="barrow">
                  <div class="barlabel">Nutrition</div>
                  <div class="bar"><div class="barfill" id="barNutrition" style="width:0%"></div></div>
                  <div class="barnum" id="numNutrition">—</div>
                </div>
                <div class="barrow">
                  <div class="barlabel">Risk</div>
                  <div class="bar"><div class="barfill" id="barRisk" style="width:0%"></div></div>
                  <div class="barnum" id="numRisk">—</div>
                </div>
              </div>
            </div>

            <details class="explain">
              <summary>How the PIQ Score is calculated (transparent)</summary>
              <div id="piqExplain" class="mono small"></div>
            </details>
          </div>

          <div class="card">
            <div class="cardhead">
              <h2>Risk Detection</h2>
              <span class="muted">Heuristic flags</span>
            </div>
            <div class="row gap">
              <div class="field">
                <label>Pick athlete</label>
                <select id="riskAthlete"></select>
              </div>
              <div class="field">
                <label>As of date</label>
                <input id="riskDate" type="date" />
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn" id="btnRunRisk">Run</button>
              </div>
            </div>

            <div id="riskSummary" class="callout">—</div>

            <div class="grid2">
              <div class="mini">
                <div class="minihead">Workload</div>
                <div class="minibody mono small" id="riskWorkload">—</div>
              </div>
              <div class="mini">
                <div class="minihead">Readiness/Nutrition</div>
                <div class="minibody mono small" id="riskReadiness">—</div>
              </div>
            </div>

            <details class="explain">
              <summary>What this is (and isn’t)</summary>
              <div class="small muted">
                This tool uses simple rules from your own logged data (load trends, monotony, readiness, sleep, soreness, nutrition adherence).
                It can help you notice patterns, but it is not a diagnosis and cannot confirm injury risk.
              </div>
            </details>
          </div>
        </div>

        <div class="card">
          <div class="cardhead">
            <h2>Team Heatmap Dashboard</h2>
            <span class="muted">Load intensity across athletes</span>
          </div>

          <div class="row gap wrap">
            <div class="field">
              <label>Start</label>
              <input id="heatStart" type="date" />
            </div>
            <div class="field">
              <label>Days</label>
              <input id="heatDays" type="number" min="7" max="60" step="1" value="21" />
            </div>
            <div class="field">
              <label>Metric</label>
              <select id="heatMetric">
                <option value="load">Training Load (sRPE × minutes)</option>
                <option value="readiness">Readiness (0–100)</option>
                <option value="nutrition">Nutrition adherence (0–100)</option>
                <option value="risk">Risk index (0–100)</option>
              </select>
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button class="btn" id="btnHeatmap">Render Heatmap</button>
            </div>
          </div>

          <div class="heatwrap">
            <div class="heatscroll">
              <table class="heattable" id="heatTable" aria-label="Team heatmap table"></table>
            </div>
          </div>

          <div class="small muted">
            Tip: click any cell to jump to that athlete/date in the Log view.
          </div>
        </div>
      </section>

      <!-- TEAM -->
      <section class="view" id="view-team" data-view hidden>
        <div class="grid2">
          <div class="card">
            <div class="cardhead">
              <h2>Roster</h2>
              <span class="muted">Athletes</span>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Full name</label>
                <input id="athName" placeholder="e.g., Jordan Smith" />
              </div>
              <div class="field">
                <label>Position</label>
                <input id="athPos" placeholder="PG / SG / SF / PF / C" />
              </div>
              <div class="field">
                <label>Height (in)</label>
                <input id="athHt" type="number" min="40" max="96" />
              </div>
              <div class="field">
                <label>Weight (lb)</label>
                <input id="athWt" type="number" min="60" max="400" />
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn" id="btnAddAthlete">Add</button>
              </div>
            </div>

            <div class="list" id="rosterList"></div>
          </div>

          <div class="card">
            <div class="cardhead">
              <h2>Team Settings</h2>
              <span class="muted">Identity + defaults</span>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Team name</label>
                <input id="teamName" placeholder="Default" />
              </div>
              <div class="field">
                <label>Season start</label>
                <input id="seasonStart" type="date" />
              </div>
              <div class="field">
                <label>Season end</label>
                <input id="seasonEnd" type="date" />
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn" id="btnSaveTeam">Save</button>
              </div>
            </div>

            <hr class="sep" />

            <div class="grid2">
              <div class="mini">
                <div class="minihead">Default macro target (per athlete)</div>
                <div class="minibody small muted">
                  You can override per athlete inside Elite Nutrition.
                </div>
                <div class="row gap wrap">
                  <div class="field">
                    <label>Protein (g)</label>
                    <input id="defProt" type="number" min="0" max="400" value="160" />
                  </div>
                  <div class="field">
                    <label>Carbs (g)</label>
                    <input id="defCarb" type="number" min="0" max="800" value="240" />
                  </div>
                  <div class="field">
                    <label>Fat (g)</label>
                    <input id="defFat" type="number" min="0" max="300" value="70" />
                  </div>
                </div>
                <button class="btn" id="btnSaveMacroDefaults">Save macro defaults</button>
              </div>

              <div class="mini">
                <div class="minihead">PIQ Score weights</div>
                <div class="minibody small muted">
                  Adjust how the PIQ Score blends sub-scores. Must total 100.
                </div>
                <div class="row gap wrap">
                  <div class="field"><label>Readiness</label><input id="wReadiness" type="number" min="0" max="100" value="30" /></div>
                  <div class="field"><label>Training</label><input id="wTraining" type="number" min="0" max="100" value="25" /></div>
                  <div class="field"><label>Recovery</label><input id="wRecovery" type="number" min="0" max="100" value="20" /></div>
                  <div class="field"><label>Nutrition</label><input id="wNutrition" type="number" min="0" max="100" value="15" /></div>
                  <div class="field"><label>Risk</label><input id="wRisk" type="number" min="0" max="100" value="10" /></div>
                </div>
                <button class="btn" id="btnSaveWeights">Save weights</button>
                <div id="weightsNote" class="small muted"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- LOG -->
      <section class="view" id="view-log" data-view hidden>
        <div class="grid2">
          <div class="card">
            <div class="cardhead">
              <h2>Training Log</h2>
              <span class="muted">Session-based</span>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Athlete</label>
                <select id="logAthlete"></select>
              </div>
              <div class="field">
                <label>Date</label>
                <input id="logDate" type="date" />
              </div>
              <div class="field">
                <label>Minutes</label>
                <input id="logMin" type="number" min="0" max="600" value="60" />
              </div>
              <div class="field">
                <label>sRPE (0–10)</label>
                <input id="logRpe" type="number" min="0" max="10" step="1" value="6" />
              </div>
              <div class="field">
                <label>Type</label>
                <select id="logType">
                  <option value="practice">Practice</option>
                  <option value="lift">Lift</option>
                  <option value="skills">Skills</option>
                  <option value="conditioning">Conditioning</option>
                  <option value="game">Game</option>
                  <option value="recovery">Recovery</option>
                </select>
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn" id="btnSaveTraining">Save Session</button>
              </div>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Notes</label>
                <input id="logNotes" placeholder="optional" />
              </div>
            </div>

            <div class="mini">
              <div class="minihead">Computed</div>
              <div class="minibody mono small" id="logComputed">Load: —</div>
            </div>

            <div class="list" id="trainingList"></div>
          </div>

          <div class="card">
            <div class="cardhead">
              <h2>Readiness & Recovery</h2>
              <span class="muted">Daily check-in</span>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Athlete</label>
                <select id="readyAthlete"></select>
              </div>
              <div class="field">
                <label>Date</label>
                <input id="readyDate" type="date" />
              </div>
              <div class="field">
                <label>Sleep (hours)</label>
                <input id="readySleep" type="number" min="0" max="16" step="0.5" value="8" />
              </div>
              <div class="field">
                <label>Soreness (0–10)</label>
                <input id="readySore" type="number" min="0" max="10" step="1" value="3" />
              </div>
              <div class="field">
                <label>Stress (0–10)</label>
                <input id="readyStress" type="number" min="0" max="10" step="1" value="3" />
              </div>
              <div class="field">
                <label>Energy (0–10)</label>
                <input id="readyEnergy" type="number" min="0" max="10" step="1" value="7" />
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn" id="btnSaveReadiness">Save Check-in</button>
              </div>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Pain/Injury note</label>
                <input id="readyInjury" placeholder="e.g., left knee tightness" />
              </div>
            </div>

            <div class="mini">
              <div class="minihead">Readiness Score (0–100)</div>
              <div class="minibody mono small" id="readyComputed">—</div>
            </div>

            <div class="list" id="readinessList"></div>
          </div>
        </div>
      </section>

      <!-- ELITE NUTRITION -->
      <section class="view" id="view-nutrition" data-view hidden>
        <div class="grid2">
          <div class="card">
            <div class="cardhead">
              <h2>Elite Nutrition Add-on</h2>
              <span class="muted">Macros + adherence</span>
            </div>

            <div class="callout" id="nutPaywall" style="display:none">
              <b>Elite Nutrition is a paid upgrade.</b>
              <div class="small muted">Unlock to enable meal plans, micronutrient targets, and timing recommendations.</div>
              <div class="row gap wrap" style="margin-top:10px">
                <input id="unlockCode" placeholder="Enter unlock code" class="grow" />
                <button class="btn" id="btnUnlock">Unlock</button>
              </div>
              <div class="small muted" id="unlockHint" style="margin-top:8px"></div>
            </div>

            <div id="nutMain">
              <div class="row gap wrap">
                <div class="field">
                  <label>Athlete</label>
                  <select id="nutAthlete"></select>
                </div>
                <div class="field">
                  <label>Date</label>
                  <input id="nutDate" type="date" />
                </div>
                <div class="field">
                  <label>Protein (g)</label>
                  <input id="nutProt" type="number" min="0" max="500" value="0" />
                </div>
                <div class="field">
                  <label>Carbs (g)</label>
                  <input id="nutCarb" type="number" min="0" max="1000" value="0" />
                </div>
                <div class="field">
                  <label>Fat (g)</label>
                  <input id="nutFat" type="number" min="0" max="400" value="0" />
                </div>
                <div class="field">
                  <label>Water (oz)</label>
                  <input id="nutWater" type="number" min="0" max="300" value="0" />
                </div>
                <div class="field">
                  <label>&nbsp;</label>
                  <button class="btn" id="btnSaveNutrition">Save</button>
                </div>
              </div>

              <div class="row gap wrap">
                <div class="field grow">
                  <label>Notes</label>
                  <input id="nutNotes" placeholder="optional (timing, appetite, etc.)" />
                </div>
              </div>

              <div class="mini">
                <div class="minihead">Adherence (0–100)</div>
                <div class="minibody mono small" id="nutComputed">—</div>
              </div>

              <div class="list" id="nutritionList"></div>
            </div>
          </div>

          <div class="card">
            <div class="cardhead">
              <h2>Targets & Tools</h2>
              <span class="muted">Per athlete targets + meal plans</span>
            </div>

            <div id="targetsBlock">
              <div class="row gap wrap">
                <div class="field">
                  <label>Athlete</label>
                  <select id="targetAthlete"></select>
                </div>
                <div class="field">
                  <label>Target Protein (g)</label>
                  <input id="tProt" type="number" min="0" max="500" />
                </div>
                <div class="field">
                  <label>Target Carbs (g)</label>
                  <input id="tCarb" type="number" min="0" max="1000" />
                </div>
                <div class="field">
                  <label>Target Fat (g)</label>
                  <input id="tFat" type="number" min="0" max="400" />
                </div>
                <div class="field">
                  <label>Target Water (oz)</label>
                  <input id="tWater" type="number" min="0" max="300" />
                </div>
                <div class="field">
                  <label>&nbsp;</label>
                  <button class="btn" id="btnSaveTargets">Save Targets</button>
                </div>
              </div>

              <hr class="sep" />

              <div class="mini">
                <div class="minihead">Quick meal builder (no database)</div>
                <div class="minibody small muted">
                  Enter a meal macro estimate and append it to today’s totals.
                </div>
                <div class="row gap wrap">
                  <div class="field"><label>Protein</label><input id="qmProt" type="number" min="0" max="200" value="30" /></div>
                  <div class="field"><label>Carbs</label><input id="qmCarb" type="number" min="0" max="300" value="60" /></div>
                  <div class="field"><label>Fat</label><input id="qmFat" type="number" min="0" max="150" value="15" /></div>
                  <div class="field"><label>Water</label><input id="qmWater" type="number" min="0" max="80" value="16" /></div>
                  <div class="field"><label>&nbsp;</label><button class="btn ghost" id="btnQuickMeal">Add to today</button></div>
                </div>
              </div>

              <!-- ✅ CLEAN SINGLE MEAL PLAN GENERATOR (unique IDs) -->
              <div class="mini" id="mealPlanBlock">
                <div class="minihead">Meal plan generator (Elite)</div>
                <div class="minibody small muted">
                  Generates a day plan using your macro targets, training day context, and simple micronutrient focus.
                </div>

                <div class="row gap wrap">
                  <div class="field">
                    <label>Athlete</label>
                    <select id="mealAthlete"></select>
                  </div>

                  <div class="field">
                    <label>Start date</label>
                    <input id="mealStart" type="date" />
                  </div>

                  <div class="field">
                    <label>Days</label>
                    <input id="mealDays" type="number" min="1" max="21" step="1" value="7" />
                  </div>

                  <div class="field">
                    <label>Day type</label>
                    <select id="mealDayType">
                      <option value="training">Training day</option>
                      <option value="game">Game day</option>
                      <option value="recovery">Recovery day</option>
                      <option value="rest">Rest day</option>
                      <option value="auto">Auto (weekend rest)</option>
                    </select>
                  </div>

                  <div class="field">
                    <label>Diet preference</label>
                    <select id="mealDiet">
                      <option value="standard">Standard</option>
                      <option value="highprotein">Higher protein</option>
                      <option value="lowerfat">Lower fat</option>
                    </select>
                  </div>

                  <div class="field">
                    <label>&nbsp;</label>
                    <button class="btn" id="btnGenerateMealPlan">Generate Plan</button>
                  </div>
                </div>

                <div class="mini" style="margin-top:12px">
                  <div class="minihead">Generated plan</div>
                  <div id="mealPlanOut" class="minibody"></div>
                </div>
              </div>

              <details class="explain">
                <summary>How adherence is calculated</summary>
                <div class="mono small" id="nutExplain"></div>
              </details>
            </div>
          </div>
        </div>
      </section>

      <!-- PERIODIZATION -->
      <section class="view" id="view-periodization" data-view hidden>
        <div class="grid2">
          <div class="card">
            <div class="cardhead">
              <h2>Periodization Engine</h2>
              <span class="muted">Build weeks with deload logic</span>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Athlete</label>
                <select id="perAthlete"></select>
              </div>
              <div class="field">
                <label>Start date</label>
                <input id="perStart" type="date" />
              </div>
              <div class="field">
                <label>Weeks</label>
                <input id="perWeeks" type="number" min="2" max="24" value="8" />
              </div>
              <div class="field">
                <label>Goal</label>
                <select id="perGoal">
                  <option value="inseason">In-season performance</option>
                  <option value="offseason">Off-season development</option>
                  <option value="rehab">Return-to-play (light)</option>
                </select>
              </div>
              <div class="field">
                <label>Deload frequency</label>
                <select id="perDeload">
                  <option value="4">Every 4th week</option>
                  <option value="3">Every 3rd week</option>
                  <option value="5">Every 5th week</option>
                </select>
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn" id="btnGeneratePlan">Generate</button>
              </div>
            </div>

            <div class="mini">
              <div class="minihead">Plan rules (editable in code)</div>
              <div class="minibody small muted">
                This creates a weekly template and suggested session loads (minutes × sRPE targets). You can log actual sessions in Log.
              </div>
            </div>

            <div class="list" id="planList"></div>
          </div>

          <div class="card">
            <div class="cardhead">
              <h2>Plan-to-Load Monitor</h2>
              <span class="muted">Compare planned vs actual</span>
            </div>

            <div class="row gap wrap">
              <div class="field">
                <label>Athlete</label>
                <select id="monAthlete"></select>
              </div>
              <div class="field">
                <label>Week start (Mon)</label>
                <input id="monWeek" type="date" />
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button class="btn" id="btnCompareWeek">Compare</button>
              </div>
            </div>

            <div id="compareSummary" class="callout">—</div>
            <div class="mono small" id="compareDetail">—</div>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section class="view" id="view-settings" data-view hidden>
        <div class="card">
          <div class="cardhead">
            <h2>Settings</h2>
            <span class="muted">Storage + upgrade</span>
          </div>

          <div class="grid2">
            <div class="mini">
              <div class="minihead">Local storage</div>
              <div class="minibody small muted">
                Everything is saved in your browser on this device.
              </div>
              <button class="btn danger" id="btnWipe">Wipe all local data</button>
            </div>

            <div class="mini">
              <div class="minihead">App info</div>
              <div class="minibody mono small" id="appInfo">—</div>
            </div>
          </div>
        </div>
      </section>

    </section>
  </main>

  <footer class="footer">
    <span class="muted">PerformanceIQ • Offline-first build</span>
  </footer>

  <script src="./dataStore.js"></script>
  <script src="./nutritionEngine.js"></script>
  <script src="./core.js"></script>
</body>
                  </html>
