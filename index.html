<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0f14" />
  <title>PerformanceIQ</title>
  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <!-- Splash -->
  <div id="splash" class="splash" aria-hidden="false">
    <div class="splash-card">
      <div class="brand">
        <div class="logo-dot"></div>
        <div>
          <div class="brand-title">PerformanceIQ</div>
          <div class="brand-sub">Offline-first • Team-ready</div>
        </div>
      </div>
      <div class="splash-loading">
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div class="skeleton"></div>
        <div id="splashText" class="muted small" style="margin-top:10px">Preparing your workspace…</div>
      </div>
    </div>
  </div>

  <!-- Topbar -->
  <header class="topbar">
    <div class="topbar-left">
      <div class="appmark">
        <span class="appmark-dot" aria-hidden="true"></span>
        <span class="appmark-title">PerformanceIQ</span>
      </div>

      <span class="pill" id="savePill" title="Save status">
        <span class="dot" id="saveDot"></span>
        <span id="saveText">Saved</span>
      </span>

      <span class="pill" id="teamPill" title="Active team">Team: —</span>
      <span class="pill" id="cloudPill" title="Cloud status">Cloud: Local</span>
    </div>

    <div class="topbar-right">
      <button class="btn ghost" id="btnThemeToggle" title="Toggle dark/light">Theme</button>
      <button class="btn ghost" id="btnHelp">Help</button>
      <button class="btn" id="btnAccount">Account</button>
    </div>
  </header>

  <!-- Layout -->
  <main class="layout">
    <!-- Desktop nav -->
    <nav class="nav" role="navigation" aria-label="Primary" id="desktopNav">
      <button class="navbtn" data-view="home">Home</button>
      <button class="navbtn" data-view="team">Team</button>
      <button class="navbtn" data-view="train">Train</button>
      <button class="navbtn" data-view="profile">Profile</button>
    </nav>

    <!-- Content -->
    <section class="content">
      <section class="view" id="view-home" data-view>
        <div class="card">
          <div class="card-title">Home</div>
          <div class="small muted" id="homeSub">Welcome back.</div>

          <div class="grid2" style="margin-top:12px">
            <div class="mini">
              <div class="minihead row between">
                <span>Today</span>
                <button class="iconbtn" id="tipToday" title="What is Today?">?</button>
              </div>
              <div class="minibody" id="todayBlock">—</div>

              <div style="margin-top:10px">
                <button class="btn" id="todayButton">Generate → Start → Log</button>
                <div id="todayTimer" class="small muted" style="margin-top:8px">No timer running</div>
              </div>
            </div>

            <div class="mini">
              <div class="minihead row between">
                <span>Quick actions</span>
                <button class="iconbtn" id="tipQuick" title="Quick actions?">?</button>
              </div>
              <div class="row gap wrap">
                <button class="btn" id="qaTrain">Open Train</button>
                <button class="btn ghost" id="qaTeam">Manage Team</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="view" id="view-team" data-view hidden>
        <div class="card">
          <div class="card-title row between">
            <span>Team</span>
            <button class="iconbtn" id="tipTeam" title="Team help">?</button>
          </div>
          <div class="small muted">Roster, join codes, and access.</div>
          <div id="teamBody" style="margin-top:12px"></div>
        </div>
      </section>

      <section class="view" id="view-train" data-view hidden>
        <div class="card">
          <div class="card-title row between">
            <span>Train</span>
            <button class="iconbtn" id="tipTrain" title="Train help">?</button>
          </div>
          <div class="small muted" id="trainSub">Workouts tailored to the selected sport.</div>
          <div id="trainBody" style="margin-top:12px"></div>
        </div>
      </section>

      <section class="view" id="view-profile" data-view hidden>
        <div class="card">
          <div class="card-title row between">
            <span>Profile</span>
            <button class="iconbtn" id="tipProfile" title="Profile help">?</button>
          </div>
          <div class="small muted">Your role, sport, preferences, and account.</div>
          <div id="profileBody" style="margin-top:12px"></div>
        </div>
      </section>
    </section>
  </main>

  <!-- Mobile bottom nav -->
  <nav class="bottomnav" id="bottomNav" aria-label="Bottom Navigation">
    <button class="tab" data-view="home"><span class="tablbl">Home</span></button>
    <button class="tab" data-view="team"><span class="tablbl">Team</span></button>
    <button class="tab" data-view="train"><span class="tablbl">Train</span></button>
    <button class="tab" data-view="profile"><span class="tablbl">Profile</span></button>
  </nav>

  <!-- Floating Action Button -->
  <button class="fab" id="fab">＋</button>
  <div class="sheet-backdrop" id="sheetBackdrop" hidden></div>
  <div class="sheet" id="fabSheet" hidden>
    <div class="sheet-head">
      <div>
        <div class="sheet-title">Quick Log</div>
        <div class="small muted">3 taps from anywhere.</div>
      </div>
      <button class="btn ghost" id="btnCloseSheet">Close</button>
    </div>
    <div class="sheet-body">
      <button class="btn" id="fabLogWorkout">Log workout</button>
      <button class="btn ghost" id="fabLogNutrition">Log nutrition</button>
      <button class="btn ghost" id="fabLogWellness">Log wellness</button>
      <div class="small muted" style="margin-top:10px">Tip: Use Train → Save session for detailed logs.</div>
    </div>
  </div>

  <!-- Account Drawer -->
  <div class="drawer-backdrop" id="drawerBackdrop" hidden></div>
  <aside class="drawer" id="accountDrawer" aria-hidden="true">
    <div class="drawer-head">
      <div>
        <div class="drawer-title">Account</div>
        <div class="small muted">Sign in & sync across devices (optional)</div>
      </div>
      <button class="btn ghost" id="btnCloseDrawer">Close</button>
    </div>

    <div class="drawer-body">
      <div class="card subtle">
        <div class="card-title row between">
          <span>Appearance</span>
          <button class="iconbtn" id="tipTheme" title="Theme help">?</button>
        </div>

        <div class="grid2" style="margin-top:10px">
          <div class="field">
            <label>Mode</label>
            <select id="themeModeSelect">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
            </select>
          </div>

          <div class="field">
            <label>Sport theme accent</label>
            <select id="themeSportSelect">
              <option value="basketball">Basketball</option>
              <option value="football">Football</option>
              <option value="soccer">Soccer</option>
              <option value="baseball">Baseball</option>
              <option value="volleyball">Volleyball</option>
              <option value="track">Track</option>
            </select>
          </div>
        </div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn" id="btnSaveTheme">Save theme</button>
        </div>
      </div>

      <div class="card subtle" style="margin-top:12px">
        <div class="card-title row between">
          <span>Role & Sport</span>
          <button class="iconbtn" id="tipRoleSport" title="Role & sport help">?</button>
        </div>

        <div class="grid2" style="margin-top:10px">
          <div class="field">
            <label>Role</label>
            <select id="roleSelect">
              <option value="coach">Coach</option>
              <option value="athlete">Athlete</option>
              <option value="parent">Parent</option>
            </select>
          </div>

          <div class="field">
            <label>Sport</label>
            <select id="sportSelect">
              <option value="basketball">Basketball</option>
              <option value="football">Football</option>
              <option value="soccer">Soccer</option>
              <option value="baseball">Baseball</option>
              <option value="volleyball">Volleyball</option>
              <option value="track">Track</option>
            </select>
          </div>
        </div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn" id="btnSaveProfile">Save</button>
          <button class="btn ghost" id="btnRunTour">Tour this tab</button>
        </div>
      </div>

      <div class="card subtle" style="margin-top:12px">
        <div class="card-title">Cloud settings</div>
        <div class="small muted">If not set, the app stays local-only.</div>

        <div class="grid2" style="margin-top:10px">
          <div class="field">
            <label>Supabase URL</label>
            <input id="sbUrl" type="text" placeholder="https://xxxx.supabase.co" />
          </div>
          <div class="field">
            <label>Anon key</label>
            <input id="sbAnon" type="password" placeholder="eyJ..." />
          </div>
        </div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn" id="btnSaveCloud">Save cloud settings</button>
          <button class="btn ghost" id="btnTestCloud">Test</button>
        </div>

        <div class="small muted" id="cloudMsg" style="margin-top:8px">—</div>
      </div>

      <div class="card subtle" style="margin-top:12px">
        <div class="card-title">Sign in / Sign up</div>

        <div class="grid2" style="margin-top:10px">
          <div class="field">
            <label>Email</label>
            <input id="authEmail" type="email" placeholder="you@email.com" />
          </div>
          <div class="field">
            <label>Password</label>
            <input id="authPass" type="password" placeholder="••••••••" />
          </div>
        </div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn" id="btnSignIn">Sign in</button>
          <button class="btn ghost" id="btnSignUp">Create account</button>
          <button class="btn danger" id="btnSignOut">Sign out</button>
        </div>

        <div class="small muted" id="authMsg" style="margin-top:8px">—</div>
      </div>

      <div class="card subtle" style="margin-top:12px">
        <div class="card-title">Sync</div>
        <div class="small muted">Sync is optional. You can always keep using local mode.</div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn ghost" id="btnPull">Pull from cloud</button>
          <button class="btn" id="btnPush">Push to cloud</button>
        </div>

        <div class="small muted" id="syncMsg" style="margin-top:8px">—</div>
      </div>

      <!-- Data Management -->
      <div class="card subtle" style="margin-top:12px">
        <div class="card-title row between">
          <span>Data Management</span>
          <button class="iconbtn" id="tipDataMgmt" title="Data Management help">?</button>
        </div>
        <div class="small muted">Export, import, or reset this device. Undo is available for 6 seconds.</div>

        <div class="row gap wrap" style="margin-top:10px">
          <button class="btn ghost" id="btnExport">Export JSON</button>

          <label class="btn ghost" style="display:inline-flex;align-items:center;gap:8px">
            Import JSON
            <input id="fileImport" type="file" accept="application/json" style="display:none" />
          </label>

          <button class="btn danger" id="btnResetLocal">Seed Demo / Reset</button>
        </div>

        <div class="small muted" id="dataMsg" style="margin-top:8px">—</div>
      </div>

      <div style="margin-top:14px">
        <button class="btn ghost" id="btnRunGrade">Run QA Grade</button>
        <div id="gradeReport" class="small muted" style="margin-top:8px">—</div>
      </div>
    </div>
  </aside>

  <!-- Help drawer -->
  <div class="drawer-backdrop" id="helpBackdrop" hidden></div>
  <aside class="drawer drawer-help" id="helpDrawer" aria-hidden="true">
    <div class="drawer-head">
      <div>
        <div class="drawer-title">Help</div>
        <div class="small muted">Search help (Ctrl/⌘+K)</div>
      </div>
      <button class="btn ghost" id="btnCloseHelp">Close</button>
    </div>
    <div class="drawer-body">
      <div class="field">
        <label>Search</label>
        <input id="helpSearch" type="text" placeholder="Search: Today, Train, sRPE, injuries, export…" />
      </div>
      <div id="helpResults" style="margin-top:10px"></div>
    </div>
  </aside>

  <!-- Toasts -->
  <div class="toast" id="toast" hidden></div>
  <div class="toast" id="undoToast" hidden></div>

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script src="./dataStore.js"></script>
  <script src="./nutritionEngine.js"></script>
  <script src="./periodizationEngine.js"></script>
  <script src="./core.js"></script>
</body>
</html>
